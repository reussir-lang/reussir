// RUN: %reussir-elab --mode semi %s
// RUN: %reussir-elab --mode full %s | %FileCheck %s

// CHECK-DAG: struct _RIC4CellyE (aka Cell<u64>){
// CHECK-NEXT-DAG: value: u64
// CHECK-NEXT-DAG: }

// CHECK-DAG: regional fn _RC17regional_function(x: u64) -> Rc<_RIC4CellyE, Flex> {
// CHECK-NEXT-DAG: rc_wrap(compound(v0) : _RIC4CellyE) : Rc<_RIC4CellyE, Flex>
// CHECK-NEXT-DAG: }

// CHECK-DAG: fn _RC25freeze_cell_with_let_expr() -> Rc<_RIC4CellyE, Rigid> {
// CHECK-NEXT-DAG: run_region{let v0 (x) : Rc<_RIC4CellyE, Flex> = regional_function[regional](42.0 : u64) : Rc<_RIC4CellyE, Flex> in
// CHECK-NEXT-DAG: v0} : Rc<_RIC4CellyE, Rigid>
// CHECK-NEXT-DAG: }

// CHECK-DAG: fn _RC7trivial() -> u64 {
// CHECK-NEXT-DAG: run_region{1.0 : u64} : u64
// CHECK-NEXT-DAG: }

// CHECK-DAG: fn _RC11freeze_cell() -> Rc<_RIC4CellyE, Rigid> {
// CHECK-NEXT-DAG: run_region{rc_wrap(compound(1.0 : u64) : _RIC4CellyE) : Rc<_RIC4CellyE, Flex>} : Rc<_RIC4CellyE, Rigid>
// CHECK-NEXT-DAG: }
fn trivial() -> u64 {
    regional {
        1
    }
}

struct [regional] Cell<T> {
    value: T
}

struct [regional] Container<T> {
    cell: [field] Cell<T>
}

fn freeze_cell() -> Cell<u64> {
    regional {
        Cell{value: 1}
    }
}

fn freeze_cell_with_let_expr() -> Cell<u64> {
    regional {
        let x : [flex] Cell<u64> = regional_function(42);
        x
    }
}

regional fn regional_function(x : u64) -> [flex] Cell<u64> {
    Cell{value: x}
}
