diff --git a/CMakeLists.txt b/CMakeLists.txt
index 965f8fd..ab10d05 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -65,7 +65,7 @@ if (TPDE_ENABLE_ENCODEGEN OR TPDE_ENABLE_LLVM)
     # LLVM versions we currently support. The first version should be the
     # "primary" versions where all tests pass (i.e., no XFAIL due to different
     # code generation).
-    set(TPDE_LLVM_SUPPORTED_VERSIONS 20.1 19.1)
+    set(TPDE_LLVM_SUPPORTED_VERSIONS 21.1 20.1 19.1)
 
     # allow overriding the LLVM version used
     if (DEFINED LLVM_DIR)
diff --git a/tpde-encodegen/src/x64/Target.cpp b/tpde-encodegen/src/x64/Target.cpp
index 89e7963..7a70d79 100644
--- a/tpde-encodegen/src/x64/Target.cpp
+++ b/tpde-encodegen/src/x64/Target.cpp
@@ -457,6 +457,12 @@ void EncodingTargetX64::get_inst_candidates(
       handle_default(fd_mnem_i, memop_start);
     }
   };
+  const auto handle_locked_mi8 = [&](std::string_view llvm_mnem,
+                                     std::string_view fd_mnem) {
+    if (std::string_view(Name) == llvm_mnem) {
+      handle_default(fd_mnem, 0);
+    }
+  };
 
   // clang-format off
   handle_rm("MOVZX32rr8", "MOVZX32rm8", 1, "MOVZXr32r8", "MOVZXr32m8");
@@ -761,6 +767,36 @@ void EncodingTargetX64::get_inst_candidates(
   case_default("MOVMSKPDrr", -1, "SSE_MOVMSKPDrr");
 
   case_default("MFENCE", -1, "MFENCE");
+
+  // Locked atomic operations with 8-bit immediates (LLVM 21+)
+  handle_locked_mi8("OR8mi8Locked", "LOCK_OR8mi");
+  handle_locked_mi8("OR16mi8Locked", "LOCK_OR16mi");
+  handle_locked_mi8("OR32mi8Locked", "LOCK_OR32mi");
+  handle_locked_mi8("OR64mi8Locked", "LOCK_OR64mi");
+  handle_locked_mi8("AND8mi8Locked", "LOCK_AND8mi");
+  handle_locked_mi8("AND16mi8Locked", "LOCK_AND16mi");
+  handle_locked_mi8("AND32mi8Locked", "LOCK_AND32mi");
+  handle_locked_mi8("AND64mi8Locked", "LOCK_AND64mi");
+  handle_locked_mi8("XOR8mi8Locked", "LOCK_XOR8mi");
+  handle_locked_mi8("XOR16mi8Locked", "LOCK_XOR16mi");
+  handle_locked_mi8("XOR32mi8Locked", "LOCK_XOR32mi");
+  handle_locked_mi8("XOR64mi8Locked", "LOCK_XOR64mi");
+  handle_locked_mi8("ADD8mi8Locked", "LOCK_ADD8mi");
+  handle_locked_mi8("ADD16mi8Locked", "LOCK_ADD16mi");
+  handle_locked_mi8("ADD32mi8Locked", "LOCK_ADD32mi");
+  handle_locked_mi8("ADD64mi8Locked", "LOCK_ADD64mi");
+  handle_locked_mi8("SUB8mi8Locked", "LOCK_SUB8mi");
+  handle_locked_mi8("SUB16mi8Locked", "LOCK_SUB16mi");
+  handle_locked_mi8("SUB32mi8Locked", "LOCK_SUB32mi");
+  handle_locked_mi8("SUB64mi8Locked", "LOCK_SUB64mi");
+  handle_locked_mi8("ADC8mi8Locked", "LOCK_ADC8mi");
+  handle_locked_mi8("ADC16mi8Locked", "LOCK_ADC16mi");
+  handle_locked_mi8("ADC32mi8Locked", "LOCK_ADC32mi");
+  handle_locked_mi8("ADC64mi8Locked", "LOCK_ADC64mi");
+  handle_locked_mi8("SBB8mi8Locked", "LOCK_SBB8mi");
+  handle_locked_mi8("SBB16mi8Locked", "LOCK_SBB16mi");
+  handle_locked_mi8("SBB32mi8Locked", "LOCK_SBB32mi");
+  handle_locked_mi8("SBB64mi8Locked", "LOCK_SBB64mi");
   // clang-format on
 
   if (Name == "LCMPXCHG64") {
